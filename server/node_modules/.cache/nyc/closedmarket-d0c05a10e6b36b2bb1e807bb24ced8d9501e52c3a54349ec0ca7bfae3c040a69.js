'use strict';function cov_2mx8f6xz7j(){var path="C:\\Users\\Ramses Coraspe\\Documents\\GitHub\\RESTful-APIs-Nodejs\\server\\middlewares\\closedmarket.js";var hash="d63f24c03fde0c89697eb99fd38ed91c31e7e91c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Ramses Coraspe\\Documents\\GitHub\\RESTful-APIs-Nodejs\\server\\middlewares\\closedmarket.js",statementMap:{"0":{start:{line:2,column:13},end:{line:2,column:30}},"1":{start:{line:3,column:13},end:{line:3,column:47}},"2":{start:{line:4,column:23},end:{line:4,column:55}},"3":{start:{line:8,column:0},end:{line:67,column:2}},"4":{start:{line:10,column:23},end:{line:10,column:24}},"5":{start:{line:12,column:4},end:{line:22,column:5}},"6":{start:{line:14,column:19},end:{line:14,column:29}},"7":{start:{line:15,column:18},end:{line:15,column:39}},"8":{start:{line:16,column:8},end:{line:16,column:52}},"9":{start:{line:20,column:8},end:{line:20,column:68}},"10":{start:{line:25,column:4},end:{line:66,column:5}},"11":{start:{line:27,column:8},end:{line:27,column:15}},"12":{start:{line:31,column:8},end:{line:63,column:9}},"13":{start:{line:33,column:20},end:{line:55,column:19}},"14":{start:{line:34,column:24},end:{line:54,column:25}},"15":{start:{line:35,column:28},end:{line:35,column:114}},"16":{start:{line:39,column:43},end:{line:43,column:31}},"17":{start:{line:39,column:85},end:{line:43,column:29}},"18":{start:{line:45,column:41},end:{line:45,column:43}},"19":{start:{line:46,column:28},end:{line:46,column:56}},"20":{start:{line:47,column:28},end:{line:47,column:55}},"21":{start:{line:48,column:28},end:{line:48,column:72}},"22":{start:{line:50,column:28},end:{line:50,column:85}},"23":{start:{line:51,column:28},end:{line:51,column:68}},"24":{start:{line:53,column:28},end:{line:53,column:86}},"25":{start:{line:58,column:25},end:{line:58,column:27}},"26":{start:{line:59,column:12},end:{line:59,column:39}},"27":{start:{line:60,column:12},end:{line:60,column:56}},"28":{start:{line:61,column:12},end:{line:61,column:48}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:22},end:{line:8,column:23}},loc:{start:{line:8,column:46},end:{line:67,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:33,column:68},end:{line:33,column:69}},loc:{start:{line:33,column:94},end:{line:55,column:17}},line:33},"2":{name:"(anonymous_2)",decl:{start:{line:39,column:78},end:{line:39,column:79}},loc:{start:{line:39,column:83},end:{line:43,column:30}},line:39}},branchMap:{"0":{loc:{start:{line:12,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:12,column:4},end:{line:22,column:5}},{start:{line:12,column:4},end:{line:22,column:5}}],line:12},"1":{loc:{start:{line:25,column:4},end:{line:66,column:5}},type:"if",locations:[{start:{line:25,column:4},end:{line:66,column:5}},{start:{line:25,column:4},end:{line:66,column:5}}],line:25},"2":{loc:{start:{line:25,column:7},end:{line:25,column:111}},type:"binary-expr",locations:[{start:{line:25,column:7},end:{line:25,column:58}},{start:{line:25,column:62},end:{line:25,column:111}}],line:25},"3":{loc:{start:{line:31,column:8},end:{line:63,column:9}},type:"if",locations:[{start:{line:31,column:8},end:{line:63,column:9}},{start:{line:31,column:8},end:{line:63,column:9}}],line:31},"4":{loc:{start:{line:34,column:24},end:{line:54,column:25}},type:"if",locations:[{start:{line:34,column:24},end:{line:54,column:25}},{start:{line:34,column:24},end:{line:54,column:25}}],line:34}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d63f24c03fde0c89697eb99fd38ed91c31e7e91c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_2mx8f6xz7j=function(){return actualCoverage;};return actualCoverage;}cov_2mx8f6xz7j();var moment=(cov_2mx8f6xz7j().s[0]++,require('moment'));var config=(cov_2mx8f6xz7j().s[1]++,require('../configuration/config'));var OrdersController=(cov_2mx8f6xz7j().s[2]++,require('../controllers/orders'));cov_2mx8f6xz7j().s[3]++;exports.closedmarket=function(req,res,next){cov_2mx8f6xz7j().f[0]++;var hour_request=(cov_2mx8f6xz7j().s[4]++,0);cov_2mx8f6xz7j().s[5]++;if(req.body.timestamp===undefined){cov_2mx8f6xz7j().b[0][0]++;var date=(cov_2mx8f6xz7j().s[6]++,new Date());var tms=(cov_2mx8f6xz7j().s[7]++,date.getTime()/1000);cov_2mx8f6xz7j().s[8]++;hour_request=moment.unix(tms).format("HH");}else{cov_2mx8f6xz7j().b[0][1]++;cov_2mx8f6xz7j().s[9]++;hour_request=moment.unix(req.body.timestamp).format("HH");}cov_2mx8f6xz7j().s[10]++;if((cov_2mx8f6xz7j().b[2][0]++,hour_request>=config.api.closed_market_hour_start)&&(cov_2mx8f6xz7j().b[2][1]++,hour_request<=config.api.closed_market_hour_end)){cov_2mx8f6xz7j().b[1][0]++;cov_2mx8f6xz7j().s[11]++;next();}else{cov_2mx8f6xz7j().b[1][1]++;cov_2mx8f6xz7j().s[12]++;if(req.params.id!=undefined){cov_2mx8f6xz7j().b[3][0]++;cov_2mx8f6xz7j().s[13]++;OrdersController.getAccountData(req.params.id,function(callbackPostData){cov_2mx8f6xz7j().f[1]++;cov_2mx8f6xz7j().s[14]++;if(callbackPostData.value===null){cov_2mx8f6xz7j().b[4][0]++;cov_2mx8f6xz7j().s[15]++;return res.status(callbackPostData.httpcode).send({message:callbackPostData.message});}else{cov_2mx8f6xz7j().b[4][1]++;var issuers=(cov_2mx8f6xz7j().s[16]++,callbackPostData.value.issuers.map(u=>{cov_2mx8f6xz7j().f[2]++;cov_2mx8f6xz7j().s[17]++;return{issuer_name:u.issuer_name,total_shares:u.total_shares,share_price:u.share_price};}));var result=(cov_2mx8f6xz7j().s[18]++,{});cov_2mx8f6xz7j().s[19]++;result.current_balance={};cov_2mx8f6xz7j().s[20]++;result.business_error=[];cov_2mx8f6xz7j().s[21]++;result.business_error.push("Closed Market");cov_2mx8f6xz7j().s[22]++;result.current_balance.cash=callbackPostData.value.cash;cov_2mx8f6xz7j().s[23]++;result.current_balance.issuers=issuers;cov_2mx8f6xz7j().s[24]++;return res.status(callbackPostData.httpcode).send(result);}});}else{cov_2mx8f6xz7j().b[3][1]++;var result=(cov_2mx8f6xz7j().s[25]++,{});cov_2mx8f6xz7j().s[26]++;result.business_error=[];cov_2mx8f6xz7j().s[27]++;result.business_error.push("Closed Market");cov_2mx8f6xz7j().s[28]++;return res.status(202).send(result);}}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsb3NlZG1hcmtldC5qcyJdLCJuYW1lcyI6WyJtb21lbnQiLCJyZXF1aXJlIiwiY29uZmlnIiwiT3JkZXJzQ29udHJvbGxlciIsImV4cG9ydHMiLCJjbG9zZWRtYXJrZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwiaG91cl9yZXF1ZXN0IiwiYm9keSIsInRpbWVzdGFtcCIsInVuZGVmaW5lZCIsImRhdGUiLCJEYXRlIiwidG1zIiwiZ2V0VGltZSIsInVuaXgiLCJmb3JtYXQiLCJhcGkiLCJjbG9zZWRfbWFya2V0X2hvdXJfc3RhcnQiLCJjbG9zZWRfbWFya2V0X2hvdXJfZW5kIiwicGFyYW1zIiwiaWQiLCJnZXRBY2NvdW50RGF0YSIsImNhbGxiYWNrUG9zdERhdGEiLCJ2YWx1ZSIsInN0YXR1cyIsImh0dHBjb2RlIiwic2VuZCIsIm1lc3NhZ2UiLCJpc3N1ZXJzIiwibWFwIiwidSIsImlzc3Vlcl9uYW1lIiwidG90YWxfc2hhcmVzIiwic2hhcmVfcHJpY2UiLCJyZXN1bHQiLCJjdXJyZW50X2JhbGFuY2UiLCJidXNpbmVzc19lcnJvciIsInB1c2giLCJjYXNoIl0sIm1hcHBpbmdzIjoiQUFBQSxhLGsvSEFDQSxHQUFJQSxDQUFBQSxNQUFNLDBCQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFWLENBQVYsQ0FDQSxHQUFJQyxDQUFBQSxNQUFNLDBCQUFHRCxPQUFPLENBQUMseUJBQUQsQ0FBVixDQUFWLENBQ0EsR0FBSUUsQ0FBQUEsZ0JBQWdCLDBCQUFHRixPQUFPLENBQUMsdUJBQUQsQ0FBVixDQUFwQixDLHdCQUlBRyxPQUFPLENBQUNDLFlBQVIsQ0FBc0IsU0FBU0MsR0FBVCxDQUFjQyxHQUFkLENBQW1CQyxJQUFuQixDQUF3Qix5QkFFMUMsR0FBSUMsQ0FBQUEsWUFBWSwwQkFBRyxDQUFILENBQWhCLENBRjBDLHdCQUkxQyxHQUFHSCxHQUFHLENBQUNJLElBQUosQ0FBU0MsU0FBVCxHQUF1QkMsU0FBMUIsQ0FBb0MsNEJBRWhDLEdBQUlDLENBQUFBLElBQUksMEJBQUcsR0FBSUMsQ0FBQUEsSUFBSixFQUFILENBQVIsQ0FDQSxHQUFJQyxDQUFBQSxHQUFHLDBCQUFHRixJQUFJLENBQUNHLE9BQUwsR0FBaUIsSUFBcEIsQ0FBUCxDQUhnQyx3QkFJaENQLFlBQVksQ0FBR1QsTUFBTSxDQUFDaUIsSUFBUCxDQUFZRixHQUFaLEVBQWlCRyxNQUFqQixDQUF3QixJQUF4QixDQUFmLENBQ0gsQ0FMRCxJQU1LLG9EQUVEVCxZQUFZLENBQUdULE1BQU0sQ0FBQ2lCLElBQVAsQ0FBWVgsR0FBRyxDQUFDSSxJQUFKLENBQVNDLFNBQXJCLEVBQWdDTyxNQUFoQyxDQUF1QyxJQUF2QyxDQUFmLENBRUgsQ0FkeUMseUJBaUIxQyxHQUFHLDRCQUFBVCxZQUFZLEVBQUlQLE1BQU0sQ0FBQ2lCLEdBQVAsQ0FBV0Msd0JBQTNCLCtCQUF1RFgsWUFBWSxFQUFJUCxNQUFNLENBQUNpQixHQUFQLENBQVdFLHNCQUFsRixDQUFILENBQTRHLHFEQUV4R2IsSUFBSSxHQUNQLENBSEQsSUFJSSxxREFFQSxHQUFHRixHQUFHLENBQUNnQixNQUFKLENBQVdDLEVBQVgsRUFBaUJYLFNBQXBCLENBQThCLHFEQUVsQlQsZ0JBQWdCLENBQUNxQixjQUFqQixDQUFnQ2xCLEdBQUcsQ0FBQ2dCLE1BQUosQ0FBV0MsRUFBM0MsQ0FBZ0QsU0FBU0UsZ0JBQVQsQ0FBMEIsa0RBQ3RFLEdBQUdBLGdCQUFnQixDQUFDQyxLQUFqQixHQUF5QixJQUE1QixDQUFpQyxxREFDN0IsTUFBT25CLENBQUFBLEdBQUcsQ0FBQ29CLE1BQUosQ0FBV0YsZ0JBQWdCLENBQUNHLFFBQTVCLEVBQXNDQyxJQUF0QyxDQUEyQyxDQUFDQyxPQUFPLENBQUNMLGdCQUFnQixDQUFDSyxPQUExQixDQUEzQyxDQUFQLENBQ0gsQ0FGRCxJQUdJLDRCQUVBLEdBQUlDLENBQUFBLE9BQU8sMkJBQUlOLGdCQUFnQixDQUFDQyxLQUFqQixDQUF1QkssT0FBdkIsQ0FBK0JDLEdBQS9CLENBQW1DQyxDQUFDLEVBQUksa0RBQUUsTUFBTyxDQUM1REMsV0FBVyxDQUFFRCxDQUFDLENBQUNDLFdBRDZDLENBRTVEQyxZQUFZLENBQUVGLENBQUMsQ0FBQ0UsWUFGNEMsQ0FHNURDLFdBQVcsQ0FBRUgsQ0FBQyxDQUFDRyxXQUg2QyxDQUFQLENBSXZELENBSmEsQ0FBSixDQUFYLENBTUEsR0FBSUMsQ0FBQUEsTUFBTSwyQkFBRyxFQUFILENBQVYsQ0FSQSx5QkFTQUEsTUFBTSxDQUFDQyxlQUFQLENBQXlCLEVBQXpCLENBVEEseUJBVUFELE1BQU0sQ0FBQ0UsY0FBUCxDQUF3QixFQUF4QixDQVZBLHlCQVdBRixNQUFNLENBQUNFLGNBQVAsQ0FBc0JDLElBQXRCLENBQTJCLGVBQTNCLEVBWEEseUJBYUFILE1BQU0sQ0FBQ0MsZUFBUCxDQUF1QkcsSUFBdkIsQ0FBOEJoQixnQkFBZ0IsQ0FBQ0MsS0FBakIsQ0FBdUJlLElBQXJELENBYkEseUJBY0FKLE1BQU0sQ0FBQ0MsZUFBUCxDQUF1QlAsT0FBdkIsQ0FBaUNBLE9BQWpDLENBZEEseUJBZ0JBLE1BQU94QixDQUFBQSxHQUFHLENBQUNvQixNQUFKLENBQVdGLGdCQUFnQixDQUFDRyxRQUE1QixFQUFzQ0MsSUFBdEMsQ0FBMkNRLE1BQTNDLENBQVAsQ0FDSCxDQUNSLENBdEJHLEVBdUJYLENBekJELElBMEJLLDRCQUNELEdBQUlBLENBQUFBLE1BQU0sMkJBQUcsRUFBSCxDQUFWLENBREMseUJBRURBLE1BQU0sQ0FBQ0UsY0FBUCxDQUF3QixFQUF4QixDQUZDLHlCQUdERixNQUFNLENBQUNFLGNBQVAsQ0FBc0JDLElBQXRCLENBQTJCLGVBQTNCLEVBSEMseUJBSUQsTUFBT2pDLENBQUFBLEdBQUcsQ0FBQ29CLE1BQUosQ0FBVyxHQUFYLEVBQWdCRSxJQUFoQixDQUFxQlEsTUFBckIsQ0FBUCxDQUVILENBR0osQ0FDSixDQTNERCIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xyXG52YXIgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XHJcbnZhciBjb25maWcgPSByZXF1aXJlKCcuLi9jb25maWd1cmF0aW9uL2NvbmZpZycpO1xyXG52YXIgT3JkZXJzQ29udHJvbGxlciA9IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL29yZGVycycpO1xyXG5cclxuXHJcblxyXG5leHBvcnRzLmNsb3NlZG1hcmtldD0gZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpe1xyXG5cclxuICAgIHZhciBob3VyX3JlcXVlc3QgPSAwXHJcblxyXG4gICAgaWYocmVxLmJvZHkudGltZXN0YW1wID09PSB1bmRlZmluZWQpe1xyXG5cclxuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdmFyIHRtcyA9IGRhdGUuZ2V0VGltZSgpIC8gMTAwMDsgICAgICAgIFxyXG4gICAgICAgIGhvdXJfcmVxdWVzdCA9IG1vbWVudC51bml4KHRtcykuZm9ybWF0KFwiSEhcIikgXHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgaG91cl9yZXF1ZXN0ID0gbW9tZW50LnVuaXgocmVxLmJvZHkudGltZXN0YW1wKS5mb3JtYXQoXCJISFwiKTtcclxuICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIGlmKGhvdXJfcmVxdWVzdCA+PSBjb25maWcuYXBpLmNsb3NlZF9tYXJrZXRfaG91cl9zdGFydCAmJiBob3VyX3JlcXVlc3QgPD0gY29uZmlnLmFwaS5jbG9zZWRfbWFya2V0X2hvdXJfZW5kKXtcclxuXHJcbiAgICAgICAgbmV4dCgpO1xyXG4gICAgfVxyXG4gICAgZWxzZXtcclxuICAgICAgICBcclxuICAgICAgICBpZihyZXEucGFyYW1zLmlkICE9IHVuZGVmaW5lZCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIE9yZGVyc0NvbnRyb2xsZXIuZ2V0QWNjb3VudERhdGEocmVxLnBhcmFtcy5pZCAsIGZ1bmN0aW9uKGNhbGxiYWNrUG9zdERhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihjYWxsYmFja1Bvc3REYXRhLnZhbHVlPT09bnVsbCl7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoY2FsbGJhY2tQb3N0RGF0YS5odHRwY29kZSkuc2VuZCh7bWVzc2FnZTpjYWxsYmFja1Bvc3REYXRhLm1lc3NhZ2V9KTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc3N1ZXJzICA9IGNhbGxiYWNrUG9zdERhdGEudmFsdWUuaXNzdWVycy5tYXAodSA9PiB7IHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNzdWVyX25hbWU6IHUuaXNzdWVyX25hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfc2hhcmVzOiB1LnRvdGFsX3NoYXJlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFyZV9wcmljZTogdS5zaGFyZV9wcmljZSAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmN1cnJlbnRfYmFsYW5jZSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmJ1c2luZXNzX2Vycm9yID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuYnVzaW5lc3NfZXJyb3IucHVzaChcIkNsb3NlZCBNYXJrZXRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5jdXJyZW50X2JhbGFuY2UuY2FzaCA9IGNhbGxiYWNrUG9zdERhdGEudmFsdWUuY2FzaFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmN1cnJlbnRfYmFsYW5jZS5pc3N1ZXJzID0gaXNzdWVyc1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKGNhbGxiYWNrUG9zdERhdGEuaHR0cGNvZGUpLnNlbmQocmVzdWx0KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgcmVzdWx0LmJ1c2luZXNzX2Vycm9yID0gW107XHJcbiAgICAgICAgICAgIHJlc3VsdC5idXNpbmVzc19lcnJvci5wdXNoKFwiQ2xvc2VkIE1hcmtldFwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAyKS5zZW5kKHJlc3VsdCk7IFxyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxufTtcclxuIl19