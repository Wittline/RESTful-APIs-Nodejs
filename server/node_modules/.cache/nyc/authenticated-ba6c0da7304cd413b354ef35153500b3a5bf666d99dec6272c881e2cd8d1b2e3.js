'use strict';function cov_cun8vwhuv(){var path="C:\\Users\\Ramses Coraspe\\Documents\\GitHub\\RESTful-APIs-Nodejs\\server\\middlewares\\authenticated.js";var hash="3dd27b845389e29b66a74ffcd700b99e3b8ff2b3";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Ramses Coraspe\\Documents\\GitHub\\RESTful-APIs-Nodejs\\server\\middlewares\\authenticated.js",statementMap:{"0":{start:{line:2,column:10},end:{line:2,column:31}},"1":{start:{line:3,column:13},end:{line:3,column:30}},"2":{start:{line:4,column:12},end:{line:4,column:38}},"3":{start:{line:5,column:13},end:{line:5,column:47}},"4":{start:{line:8,column:0},end:{line:35,column:2}},"5":{start:{line:10,column:2},end:{line:30,column:3}},"6":{start:{line:12,column:8},end:{line:14,column:5}},"7":{start:{line:13,column:10},end:{line:13,column:81}},"8":{start:{line:16,column:16},end:{line:16,column:64}},"9":{start:{line:18,column:4},end:{line:27,column:5}},"10":{start:{line:19,column:18},end:{line:19,column:43}},"11":{start:{line:21,column:6},end:{line:23,column:7}},"12":{start:{line:22,column:8},end:{line:22,column:67}},"13":{start:{line:26,column:6},end:{line:26,column:63}},"14":{start:{line:29,column:6},end:{line:29,column:24}},"15":{start:{line:34,column:4},end:{line:34,column:11}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:20},end:{line:8,column:21}},loc:{start:{line:8,column:44},end:{line:35,column:1}},line:8}},branchMap:{"0":{loc:{start:{line:10,column:2},end:{line:30,column:3}},type:"if",locations:[{start:{line:10,column:2},end:{line:30,column:3}},{start:{line:10,column:2},end:{line:30,column:3}}],line:10},"1":{loc:{start:{line:12,column:8},end:{line:14,column:5}},type:"if",locations:[{start:{line:12,column:8},end:{line:14,column:5}},{start:{line:12,column:8},end:{line:14,column:5}}],line:12},"2":{loc:{start:{line:21,column:6},end:{line:23,column:7}},type:"if",locations:[{start:{line:21,column:6},end:{line:23,column:7}},{start:{line:21,column:6},end:{line:23,column:7}}],line:21}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"3dd27b845389e29b66a74ffcd700b99e3b8ff2b3"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_cun8vwhuv=function(){return actualCoverage;};return actualCoverage;}cov_cun8vwhuv();var jwt=(cov_cun8vwhuv().s[0]++,require('jwt-simple'));var moment=(cov_cun8vwhuv().s[1]++,require('moment'));var secret=(cov_cun8vwhuv().s[2]++,'brokerage2020tokendecode');var config=(cov_cun8vwhuv().s[3]++,require('../configuration/config'));cov_cun8vwhuv().s[4]++;exports.ensureAuth=function(req,res,next){cov_cun8vwhuv().f[0]++;cov_cun8vwhuv().s[5]++;if(config.jwt.isauthenticated){cov_cun8vwhuv().b[0][0]++;cov_cun8vwhuv().s[6]++;if(!req.headers.authorization){cov_cun8vwhuv().b[1][0]++;cov_cun8vwhuv().s[7]++;return res.status(403).send({message:'la peticion no tiene cabecera'});}else{cov_cun8vwhuv().b[1][1]++;}var token=(cov_cun8vwhuv().s[8]++,req.headers.authorization.replace(/['""]+/g,''));cov_cun8vwhuv().s[9]++;try{var payload=(cov_cun8vwhuv().s[10]++,jwt.decode(token,secret));cov_cun8vwhuv().s[11]++;if(payload.exp<=moment().unix()){cov_cun8vwhuv().b[2][0]++;cov_cun8vwhuv().s[12]++;return res.status(401).send({message:'token ha expirado'});}else{cov_cun8vwhuv().b[2][1]++;}}catch(ex){cov_cun8vwhuv().s[13]++;return res.status(404).send({message:'token no valido'});}cov_cun8vwhuv().s[14]++;req.user=payload;}else{cov_cun8vwhuv().b[0][1]++;}cov_cun8vwhuv().s[15]++;next();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0ZWQuanMiXSwibmFtZXMiOlsiand0IiwicmVxdWlyZSIsIm1vbWVudCIsInNlY3JldCIsImNvbmZpZyIsImV4cG9ydHMiLCJlbnN1cmVBdXRoIiwicmVxIiwicmVzIiwibmV4dCIsImlzYXV0aGVudGljYXRlZCIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3RhdHVzIiwic2VuZCIsIm1lc3NhZ2UiLCJ0b2tlbiIsInJlcGxhY2UiLCJwYXlsb2FkIiwiZGVjb2RlIiwiZXhwIiwidW5peCIsImV4IiwidXNlciJdLCJtYXBwaW5ncyI6IkFBQUEsYSxrOUVBQ0EsR0FBSUEsQ0FBQUEsR0FBRyx5QkFBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBVixDQUFQLENBQ0EsR0FBSUMsQ0FBQUEsTUFBTSx5QkFBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFWLENBQ0EsR0FBSUUsQ0FBQUEsTUFBTSx5QkFBRSwwQkFBRixDQUFWLENBQ0EsR0FBSUMsQ0FBQUEsTUFBTSx5QkFBR0gsT0FBTyxDQUFDLHlCQUFELENBQVYsQ0FBVixDLHVCQUdBSSxPQUFPLENBQUNDLFVBQVIsQ0FBb0IsU0FBU0MsR0FBVCxDQUFjQyxHQUFkLENBQW1CQyxJQUFuQixDQUF3QiwrQ0FFMUMsR0FBSUwsTUFBTSxDQUFDSixHQUFQLENBQVdVLGVBQWYsQ0FBK0Isa0RBRXpCLEdBQUcsQ0FBQ0gsR0FBRyxDQUFDSSxPQUFKLENBQVlDLGFBQWhCLENBQThCLGtEQUM1QixNQUFPSixDQUFBQSxHQUFHLENBQUNLLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixDQUFDQyxPQUFPLENBQUMsK0JBQVQsQ0FBckIsQ0FBUCxDQUNMLENBRkcsZ0NBSUosR0FBSUMsQ0FBQUEsS0FBSyx5QkFBR1QsR0FBRyxDQUFDSSxPQUFKLENBQVlDLGFBQVosQ0FBMEJLLE9BQTFCLENBQWtDLFNBQWxDLENBQTZDLEVBQTdDLENBQUgsQ0FBVCxDQU42Qix1QkFRN0IsR0FBSSxDQUNKLEdBQUlDLENBQUFBLE9BQU8sMEJBQUdsQixHQUFHLENBQUNtQixNQUFKLENBQVdILEtBQVgsQ0FBa0JiLE1BQWxCLENBQUgsQ0FBWCxDQURJLHdCQUdGLEdBQUdlLE9BQU8sQ0FBQ0UsR0FBUixFQUFlbEIsTUFBTSxHQUFHbUIsSUFBVCxFQUFsQixDQUFrQyxtREFDaEMsTUFBT2IsQ0FBQUEsR0FBRyxDQUFDSyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsQ0FBQ0MsT0FBTyxDQUFDLG1CQUFULENBQXJCLENBQVAsQ0FDRCxDQUZELGdDQUdELENBQUMsTUFBT08sRUFBUCxDQUFXLHlCQUVYLE1BQU9kLENBQUFBLEdBQUcsQ0FBQ0ssTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLENBQUNDLE9BQU8sQ0FBQyxpQkFBVCxDQUFyQixDQUFQLENBQ0QsQ0FqQjRCLHdCQW1CM0JSLEdBQUcsQ0FBQ2dCLElBQUosQ0FBVUwsT0FBVixDQUNILENBcEJELGdDQUYwQyx3QkEwQnhDVCxJQUFJLEdBQ1AsQ0EzQkQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcclxudmFyIGp3dCA9IHJlcXVpcmUoJ2p3dC1zaW1wbGUnKTtcclxudmFyIG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xyXG52YXIgc2VjcmV0PSAnYnJva2VyYWdlMjAyMHRva2VuZGVjb2RlJztcclxudmFyIGNvbmZpZyA9IHJlcXVpcmUoJy4uL2NvbmZpZ3VyYXRpb24vY29uZmlnJyk7XHJcblxyXG5cclxuZXhwb3J0cy5lbnN1cmVBdXRoPSBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCl7XHJcblxyXG4gIGlmIChjb25maWcuand0LmlzYXV0aGVudGljYXRlZCl7XHJcblxyXG4gICAgICAgIGlmKCFyZXEuaGVhZGVycy5hdXRob3JpemF0aW9uKXtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTonbGEgcGV0aWNpb24gbm8gdGllbmUgY2FiZWNlcmEnfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5yZXBsYWNlKC9bJ1wiXCJdKy9nLCAnJyk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgIHZhciBwYXlsb2FkID0gand0LmRlY29kZSh0b2tlbiwgc2VjcmV0KTtcclxuXHJcbiAgICAgIGlmKHBheWxvYWQuZXhwIDw9IG1vbWVudCgpLnVuaXgoKSl7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHttZXNzYWdlOid0b2tlbiBoYSBleHBpcmFkbyd9KTtcclxuICAgICAgfSAgICBcclxuICAgIH0gY2F0Y2ggKGV4KSB7XHJcblxyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoe21lc3NhZ2U6J3Rva2VuIG5vIHZhbGlkbyd9KTtcclxuICAgIH1cclxuXHJcbiAgICAgIHJlcS51c2VyPSBwYXlsb2FkO1xyXG4gIH1cclxuXHJcblxyXG4gICAgXHJcbiAgICBuZXh0KCk7XHJcbn07XHJcbiJdfQ==